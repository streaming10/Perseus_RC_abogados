<!-- Scripts optimizados y corregidos -->
<script>
// JavaScript cr√≠tico m√≠nimo - CORREGIDO
(function() {
  'use strict';
  
  // Variables globales optimizadas
  let ticking = false;
  const d = document;
  
  // Mobile menu - Funcionalidad cr√≠tica CORREGIDA
  function initMobileMenu() {
    const menuBtn = d.querySelector('.mobile-menu-btn');
    const navMenu = d.querySelector('.nav-menu');
    
    console.log('üîç Mobile menu elements:', { menuBtn, navMenu });
    
    if (!menuBtn || !navMenu) {
      console.error('‚ùå Mobile menu elements not found');
      return;
    }
    
    menuBtn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      console.log('üì± Mobile menu clicked');
      
      const isActive = navMenu.classList.contains('mobile-active');
      
      if (isActive) {
        navMenu.classList.remove('mobile-active');
        menuBtn.classList.remove('active');
        d.body.classList.remove('menu-open');
        menuBtn.setAttribute('aria-expanded', 'false');
        console.log('üì¥ Menu cerrado');
      } else {
        navMenu.classList.add('mobile-active');
        menuBtn.classList.add('active');
        d.body.classList.add('menu-open');
        menuBtn.setAttribute('aria-expanded', 'true');
        console.log('üì≤ Menu abierto');
      }
    });
    
    // Cerrar men√∫ con enlaces
    navMenu.addEventListener('click', function(e) {
      if (e.target.matches('.nav-link')) {
        navMenu.classList.remove('mobile-active');
        menuBtn.classList.remove('active');
        d.body.classList.remove('menu-open');
        menuBtn.setAttribute('aria-expanded', 'false');
        console.log('üîó Menu cerrado por clic en enlace');
      }
    });
    
    // Cerrar con Escape
    d.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navMenu.classList.contains('mobile-active')) {
        navMenu.classList.remove('mobile-active');
        menuBtn.classList.remove('active');
        d.body.classList.remove('menu-open');
        menuBtn.setAttribute('aria-expanded', 'false');
        console.log('‚å®Ô∏è Menu cerrado con Escape');
      }
    });
    
    // Cerrar al hacer click fuera
    d.addEventListener('click', function(e) {
      if (!navMenu.contains(e.target) && !menuBtn.contains(e.target)) {
        if (navMenu.classList.contains('mobile-active')) {
          navMenu.classList.remove('mobile-active');
          menuBtn.classList.remove('active');
          d.body.classList.remove('menu-open');
          menuBtn.setAttribute('aria-expanded', 'false');
          console.log('üñ±Ô∏è Menu cerrado por clic fuera');
        }
      }
    });
    
    console.log('‚úÖ Mobile menu inicializado correctamente');
  }
  
  // Header transparency optimizado
  function updateHeader() {
    const header = d.querySelector('.header');
    if (!header) return;
    
    if (window.scrollY > 50) {
      header.style.background = 'rgba(255, 255, 255, 0.98)';
      header.style.backdropFilter = 'blur(30px)';
    } else {
      header.style.background = 'rgba(255, 255, 255, 0.95)';
      header.style.backdropFilter = 'blur(20px)';
    }
    ticking = false;
  }
  
  // Smooth scroll optimizado
  function initSmoothScroll() {
    d.addEventListener('click', function(e) {
      if (e.target.matches('a[href^="#"]')) {
        e.preventDefault();
        const target = d.querySelector(e.target.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }
    });
  }
  
  // DOMContentLoaded
  d.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM Content Loaded - Inicializando scripts...');
    
    initMobileMenu();
    initSmoothScroll();
    
    // Scroll listener con throttling
    window.addEventListener('scroll', function() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }, { passive: true });
    
    console.log('‚úÖ Scripts cr√≠ticos inicializados');
  });
  
})();
</script>

<!-- JavaScript no cr√≠tico cargado despu√©s del load -->
<script>
window.addEventListener('load', function() {
  console.log('üì¶ Cargando funcionalidades no cr√≠ticas...');
  
  // Intersection Observer para animaciones (solo si es compatible)
  if ('IntersectionObserver' in window) {
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });
    
    d.querySelectorAll('.fade-in, .animate-on-scroll').forEach(function(el) {
      observer.observe(el);
    });
    
    console.log('üëÅÔ∏è Intersection Observer inicializado');
  }
  
  // Service Worker para cach√© (solo HTTPS)
  if ('serviceWorker' in navigator && location.protocol === 'https:') {
    navigator.serviceWorker.register('{{ "/sw.js" | relative_url }}')
      .then(function(registration) {
        console.log('üîß Service Worker registrado:', registration);
      })
      .catch(function(error) {
        console.log('‚ùå Service Worker fall√≥:', error);
      });
  }
  
  // Lazy loading fallback para navegadores sin soporte nativo
  if (!('loading' in HTMLImageElement.prototype)) {
    const imgObserver = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          const img = entry.target;
          if (img.dataset.src) {
            img.src = img.dataset.src;
            img.classList.remove('lazy');
            imgObserver.unobserve(img);
          }
        }
      });
    });
    
    d.querySelectorAll('img[data-src]').forEach(function(img) {
      imgObserver.observe(img);
    });
    
    console.log('üñºÔ∏è Lazy loading fallback inicializado');
  }
  
  console.log('‚úÖ Todas las funcionalidades cargadas');
});

// Prefetch enlaces importantes en hover (optimizaci√≥n UX)
d.addEventListener('mouseover', function(e) {
  if (e.target.matches('a[href^="{{ site.baseurl }}/"]') && !e.target.dataset.prefetched) {
    const link = d.createElement('link');
    link.rel = 'prefetch';
    link.href = e.target.href;
    d.head.appendChild(link);
    e.target.dataset.prefetched = 'true';
  }
}, { passive: true });
</script>
